# 发布订阅模式 解耦代码
- [B站](https://www.bilibili.com/video/BV1XJfPYQE2k)
* 2025年05月16日
* 发布订阅模式
* 
```html
import { history } from 'umi';

const eventNames = ['API:UN_AUTH', 'DATA:ERROR', 'API:UN_ACTIVE'] as const;
type EventName = (typeof eventNames)[number];

// 监听器类型：可以接受任意参数
type T = (...params: any[]) => void;

class EventEmitter {
// 事件监听器
private listeners: Record<EventName, Set<T>> = {
'API:UN_AUTH': new Set(),
'DATA:ERROR': new Set(),
'API:UN_ACTIVE': new Set(),
};

// 订阅事件
on(eventName: EventName, listener: (...args: any[]) => void) {
this.listeners[eventName].add(listener);
}

//  触发事件
emit(eventName: EventName, ...args: any[]) {
this.listeners[eventName].forEach((listener) => {
listener(...args);
});
}
}

const event = new EventEmitter();


// 订阅事件
event.on('DATA:ERROR', () => {
history.push('/result/error');
});
// 订阅事件
event.on('API:UN_ACTIVE', () => {
history.push('/activation');
})

export default event;

```
