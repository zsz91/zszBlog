# 深拷贝
## 新的原生api-structuredClone
- 兼容 chrome98及以上版本(2022.01)
### 优点
- 支持循环引用
- 支持大多数内置类型(Date, RegExp, Map, Set等)
- 性能优于JSON方法
### 缺点
- 不支持函数、DOM节点、原型链
```
const  copy = structuredClone(original);
```
## 使用ES6的WeakMap 解决循环引用
- [B站](https://www.bilibili.com/video/BV1zX4y1Y7GA)
- 不考虑带原型和类的实例那种数据结构,比如 new Date()
- WeakMap 和 Map 都可以
- [B站](https://www.bilibili.com/video/BV18gYazrEzH)
```javascript
export default function deepClone(obj) {
  const cache = new WeakMap(); // 使用WeakMap 解决循环引用的克隆 (不影响垃圾回收)
  function _deepClone(value) {
    if (value === null || typeof value !== 'object') {
      return value;
    }
    if (cache.has(value)) {
      return cache.get(value);
    }
    const result = Array.isArray(obj) ? [] : {};
    cache.set(value, result);
    for (let key in value) {
      if (value.hasOwnProperty(key)) {
        result[key] = _deepClone(value[key]);
      }
    }
    return result;
  }
  return _deepClone(obj);
}
```
