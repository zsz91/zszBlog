# fetch 流式获取数据与耗时
- [B站](https://www.bilibili.com/video/BV1faoPYdEgQ)
## fetch耗时在哪里?
- fetch请求本身只返回一个 返回头. 在 ``.json()`` 或者 ``.text()``时才会耗时.
```javascript
async function getResponse(content) {
	const resp = await fetch('url', { // 这里await 并不耗时 只会返回一个头
		method: 'POST',
		headers: {
			'Content-type': 'application/json',
		},
		body: JSON.stringify({ content }),
	});
	const text = await resp.text(); // 真正耗时的是这个 需要等待所有数据返回完成
    // const text = await resp.json();
}
```
## 流式获取数据-AI 问答
```javascript
async function getResponse(content) {
	const resp = await fetch('url', { // 这里await 并不耗时 只会返回一个头
		method: 'POST',
		headers: {
			'Content-type': 'application/json',
		},
		body: JSON.stringify({ content }),
	});
	const reader = resp.body.getReader(); // 读流式数据
	const decoder = new TextDecoder(); // 文字解码器
	while(1) {
		const { done, value } = await reader.read();
		if(done) {
			break;
		}
		const txt = decode.decode(value); // 文本
		console.log(txt);
	}
}
```
