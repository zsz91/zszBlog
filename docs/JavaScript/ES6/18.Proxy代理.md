#### 什么是Proxy(代理, 拦截)

1.  代理 对象 / 数组 / 方法
2.  Proxy 代理，可以帮助我们完成很多事情，例如对数据的处理，对构造函数的处理，对数据的验证，说白了，就是在我们访问对象前添加了一层拦截，可以过滤很多操作，而这些过滤，由你来定义。
3.  官方文档 <https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy>
4.  B站视频 <https://www.bilibili.com/video/BV1Jq4y177Fi?p=2>

#### Proxy主要功能

1.  数据劫持

2.  [万字长文： Proxy 和 Reflect](https://mp.weixin.qq.com/s/Y--hyizEZCIMtnZzdeO1tA)

3.  [从零开始用 proxy 实现 Mobx](https://zhuanlan.zhihu.com/p/27097547)

4.  13种拦截api

<!---->

     interface ProxyHandler<T extends object> {
        apply?(target: T, thisArg: any, argArray: any[]): any;
        construct?(target: T, argArray: any[], newTarget: Function): object;
        defineProperty?(target: T, p: string | symbol, attributes: PropertyDescriptor): boolean;
        deleteProperty?(target: T, p: string | symbol): boolean; // 删除
        get?(target: T, p: string | symbol, receiver: any): any;
        getOwnPropertyDescriptor?(target: T, p: string | symbol):  PropertyDescriptor | undefined; // 获取属性描述符 value writable enumerable configurable
        getPrototypeOf?(target: T): object | null; // 获取 对象的原型链接点__proto__
        has?(target: T, p: string | symbol): boolean; // 某一个属性是否属于这个对象
        isExtensible?(target: T): boolean; // 直接返回是否可扩展
        ownKeys?(target: T): ArrayLike<string | symbol>;  // 获取所有的key 返回一个数组
        preventExtensions?(target: T): boolean; // 阻止扩展
        set?(target: T, p: string | symbol, value: any, receiver: any): boolean;
        setPrototypeOf?(target: T, v: object | null): boolean; // 修改 对象的原型链接点__proto__
    }

<!---->

     const p = new Proxy(target, {
      get: function(target, property, receiver) {
                   
      }
    });

     const p = new Proxy(target, {
      set: function(target, property, value, receiver) {
                   // 原对象  key      值     原对象的proxy格式
      }
    });


      const p = new Proxy(target, {
      ownKeys: function(target) {
      }
    });

```
 let p = new Proxy(target, handler);
 
```

target ：需要使用Proxy包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）。

handler: 一个对象，其属性是当执行一个操作时定义代理的行为的函数(可以理解为某种触发器)。具体的handler相关函数请查阅官网

     let test = { name: '小红' };
     test = new Proxy(test, {
         get: function(target, key) {
             console.log('获取了getter属性');
             return target[key];
        }
     });
     console.log(test.name); // 获取了getter属性 小红;

<!---->

       let xiaohong = {
        name: "小红",
        age: 15
      };
      xiaohong = new Proxy(xiaohong, {
        get: function(target, key) {
          let result = target[key];
          //如果是获取 年龄 属性，则添加 岁字
          if (key === "age") result += "岁";
          return result;
        },
        set: function(target, key, value) {
          if (key === "age" && typeof value !== "number") {
            throw Error("age字段必须为Number类型");
          }
          // return Reflect.set(target, key, value);
          target[key] = value;
          return true;
       
        }
      });
      console.log(`我叫${xiaohong.name}  我今年${xiaohong.age}了`);
      xiaohong.age = "aa";

#### 基于Proxy 实现一个简单的双向数据绑定

<https://www.bilibili.com/video/BV1Jq4y177Fi?p=3&spm_id_from=pageDriver>

```
 let obj = {};
 const input = document.getElementById('input');
 let newObj = new Proxy(obj, {
     set(target, key, value, ){
         // 设置到 需要绑定的地方
     },
     get(target, key){
        // 
     }
 });
 
 input.addEventListener('keyup', function(e) {
     newObj.text = e.target.value;
 })
 
```

#### 2021年12月28日 实战 解决配置项无法根据其他参数改变

禅道 23771 签约申请/另行签约申请---根据不同就业方向限制图片规格和提示语

    let obj = {
      "limitImageSize": {
        "width": 1000,
        "height": 1000,
        "widthMinusHeight": 1
      },
      "limitWarnningMessage": "图片尺寸不符合要求，需要上传高清图像 1080像素及以上,请修改后重新上传！",
      "limitImageInfo": "（注：请上传高清扫描件，图像宽>1080px，高≥1080px, 图像宽度务必大于高度）"
    };

     obj = new Proxy(obj, {
         get: function(target, key) {
            // console.log(key, 'proxy代理');
            // console.log('proxy代理', window.ContractApplicationTemplateRestrictions[key]);
             if(window.ContractApplicationTemplateRestrictions){
                return window.ContractApplicationTemplateRestrictions[key];
             }else{
              return target[key];
             }
            
        }
     });

    return obj

