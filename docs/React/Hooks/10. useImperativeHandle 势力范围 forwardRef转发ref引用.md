# useImperativeHandle
- useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。
### 将子组件的方法暴露给父组件供其调用!

<https://blog.csdn.net/weixin_35958891/article/details/128416975>

### [forwardRef](https://blog.csdn.net/weixin_45389051/article/details/107093394)使用示例

`useImperativeHandle(ref, createInstance, [deps])`
- [官方文档](https://zh-hans.reactjs.org/docs/hooks-reference.html#useimperativehandle)

`useImperativeHandle`自定义使用ref时公开给父组件的实例值。在大多数情况下应避免使用ref这样的命令式代码。 useImperativeHandle应与forwardRef一起使用：
```javascript

    function FancyInput(props, ref) {
      const inputRef = useRef();
      useImperativeMethods(ref, () => ({
        focus: () => {
          inputRef.current.focus();
        }
      }));
      return <input ref={inputRef} ... />;
    }
    FancyInput = forwardRef(FancyInput);
```

在此示例中，呈现\<FancyInput ref = {fancyInputRef} />的父组件将能够调用fancyInputRef.current.focus()。

##### <https://blog.csdn.net/weixin_43720095/article/details/104967478>

1.  使用方法

    useImperativeHandle(ref, createHandle, \[deps]);

```javascript
import React, { useRef, useImperativeHandle } from 'react';
import ReactDOM from 'react-dom';

const FancyInput = React.forwardRef((props, ref) => {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));

  return <input ref={inputRef} type="text" />
});

const App = props => {
  const fancyInputRef = useRef();

  return (
    <div>
      <FancyInput ref={fancyInputRef} />
      <button
        onClick={() => fancyInputRef.current.focus()}
      >父组件调用子组件的 focus</button>
    </div>
  )
}

ReactDOM.render(<App />, root);

```

```javascript
import React, {
  useState,
  useRef,
  useImperativeHandle,
  useCallback
} from 'react';
import ReactDOM from 'react-dom';

const FancyInput = React.forwardRef((props, ref) => {
  const [ fresh, setFresh ] = useState(false)
  const attRef = useRef(0);
  useImperativeHandle(ref, () => ({
    attRef,
    fresh
  }), [ fresh ]);

  const handleClick = useCallback(() => {
    attRef.current++;
  }, []);

  return (
    <div>
      {attRef.current}
      <button onClick={handleClick}>Fancy</button>
      <button onClick={() => setFresh(!fresh)}>刷新</button>
    </div>
  )
});

const App = props => {
  const fancyInputRef = useRef();

  return (
    <div>
      <FancyInput ref={fancyInputRef} />
      <button
        onClick={() => console.log(fancyInputRef.current)}
      >父组件访问子组件的实例属性</button>
    </div>
  )
}

ReactDOM.render(<App />, root);

```

